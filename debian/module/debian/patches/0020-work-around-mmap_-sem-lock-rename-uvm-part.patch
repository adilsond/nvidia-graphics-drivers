From 426756cd1cd6776ec6e8068fedce31923db9218d Mon Sep 17 00:00:00 2001
From: Andreas Beckmann <anbe@debian.org>
Date: Sat, 29 Aug 2020 22:53:56 +0200
Subject: [PATCH 20/34] work around mmap_{sem=>lock} rename (uvm part)

---
 uvm/Makefile           | 1 +
 uvm/nvidia_uvm_linux.h | 4 ++++
 2 files changed, 5 insertions(+)

diff --git a/uvm/Makefile b/uvm/Makefile
index 93d941b..14cd218 100644
--- a/uvm/Makefile
+++ b/uvm/Makefile
@@ -174,6 +174,7 @@ COMPILE_TESTS = \
 	do_gettimeofday \
 	proc_ops \
 	timeval \
+	mm_has_mmap_lock \
 
 MODULE_NAME:= nvidia-uvm
 
diff --git a/uvm/nvidia_uvm_linux.h b/uvm/nvidia_uvm_linux.h
index d9b4c4b..8d2464e 100644
--- a/uvm/nvidia_uvm_linux.h
+++ b/uvm/nvidia_uvm_linux.h
@@ -442,5 +442,9 @@ static inline const char *kbasename(const char *str)
 }
 #endif
 
+#if defined(NV_MM_HAS_MMAP_LOCK)
+#define mmap_sem mmap_lock
+#endif
+
 #endif // _NVIDIA_UVM_LINUX_H
 
-- 
2.20.1

